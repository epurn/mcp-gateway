server {
    listen 80;
    server_name _;

    # Preserve client tracing and auth headers while blocking internal-only gateway auth header injection.
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header Authorization $http_authorization;
    proxy_set_header X-Request-ID $http_x_request_id;
    proxy_set_header X-Gateway-Auth "";
    proxy_http_version 1.1;
    proxy_buffering off;
    proxy_read_timeout 3600s;
    proxy_send_timeout 3600s;

    location = /calculator/sse {
        proxy_pass http://gateway:8000/calculator/sse;
    }

    location = /git/sse {
        proxy_pass http://gateway:8000/git/sse;
    }

    location = /docs/sse {
        proxy_pass http://gateway:8000/docs/sse;
    }

    location = /health {
        proxy_pass http://gateway:8000/health;
    }

    location = /admin/audit-logs {
        proxy_pass http://gateway:8000/admin/audit-logs;
    }

    location /files/ {
        proxy_pass http://gateway:8000/files/;
    }

    location / {
        return 404;
    }
}
